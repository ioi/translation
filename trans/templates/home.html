{% extends "base.html" %}

{% block title %} Home {% endblock %}

{% block content %}

<script type="text/javascript">
    if(performance.navigation.type == 2) {
		location.reload(true);
	}
</script>

<div class="container">
  <div class="col-md-12 col-lg-10 col-lg-offset-1">
    {% if home_content %}
      <div class="flatpage">
          {{ home_content | safe }}
      </div>
    {% endif %}

    {% for contest in tasks_lists %}
      <h2>{{ contest.title }}</h2>

      {% if user.language.code != 'en' and not is_editor %}
        <h4> You are translating into <b>{{ user.language.name }} ({{ user.language.code }}_{{ user.country.code2 }})</b></h4>
      <br>
      {% endif %}

      <table class="table table-hover">
        <thead>
          <tr>
            <th>Task</th>
            <th>Edit</th>
            {% if is_editor %}
              <th>Current Version</th>
              <th>Latest Release</th>
            {% else %}
              <th>Translation</th>
              <th>Finalize</th>
              <th>ISC Version</th>
            {% endif %}
            </tr>
        </thead>
        <tbody>
          {% for task in contest.tasks %}
            <tr
              class="task-row"
              data-contest-slug="{{ contest.slug }}"
              data-task-name="{{ task.name }}"
              data-task-frozen="{{ task.frozen|yesno:'True,False' }}">
              <td> {{ task.name }} </td>
              <td>
                {% if task.is_editing %} Is editing
                {% elif task.frozen %} Frozen
                {% else %}<a href="{% url 'edit' contest.slug task.name %}">Edit</a>{% endif %}
              </td>
              <td>
                <a href="{% url 'revisions' 'task' contest.slug task.name %}"
                   class="btn btn-default"
                   title="History">
                  <i class="fa fa-btns fa-history fa-lg"></i>
                </a>
                <!-- <a href="{% url 'task_md' 'task' contest.slug task.name %}" class="btn btn-default" title="Markdown"><i class="fa fa-btn fa-file-text-o fa-lg"></i></a> -->
                <a href="{% url 'task_pdf' 'task' contest.slug task.name %}"
                   class="btn btn-default"
                   title="PDF">
                  <i class="fa fa-btns fa-file-pdf-o fa-lg"></i>
                </a>
                {% if settings.PRINT_ENABLED and not task.frozen and not is_online %}
                  <button
                    onclick="sendPrint('{% url 'task_print' 'task' contest.slug task.name %}')"
                    class="btn btn-default"
                    title="Print ONE copy">
                    <i class="fa fa-btn fa-print fa-lg"></i>
                  </button>
                {% endif %}
              </td>
              {% if not is_editor %}
                <td>
                  {% if contest.user_contest is None or not contest.user_contest.frozen %}
                    <form method="post" action="{% url 'user_freeze_trans' task_name=task.name %}">
                      {% csrf_token %}
                      <input
                        type="hidden"
                        name="freeze"
                        value="{{ task.frozen|yesno:'False,True' }}"/>

                      {% if task.frozen %}
                        <button
                          type="submit"
                          name="reopen"
                          class="btn btn-default"
                          onclick="return confirm('Are you sure?');">
                          Reopen
                        </button>
                      {% else %}
                        {% if task.trans_id is None %}
                          <button type="submit" class="btn btn-default" disabled>
                            Not started
                          </button>
                        {% else %}
                          <button
                            type="submit"
                            class="btn btn-success"
                            name="translating"
                            value="True"
                            onclick="return confirm('Finalizing translation for {{ task.name }}. Are you sure?')">
                            Finalize
                          </button>
                        {% endif %}
                          <button
                            type="submit"
                            class="btn btn-danger"
                            name="translating"
                            value="False"
                            onclick="return confirm('Not translating {{ task.name }}. Are you sure?')">
                            Not translating
                          </button>
                      {% endif %}
                    </form>
                  {% endif %}
                </td>
              {% endif %}
              <td>
                {% if not is_editor %}
                  <a
                    href="{% url 'revisions' 'released' contest.slug task.name %}"
                    class="btn btn-default"
                    title="History">
                    <i class="fa fa-btns fa-history fa-lg"></i>
                  </a>
                {% endif %}
                  <!-- <a href="{% url 'task_md' 'released' contest.slug task.name %}" class="btn btn-default" title="Markdown"><i class="fa fa-btn fa-file-text-o fa-lg"></i></a> -->
                  <a
                    href="{% url 'task_pdf' 'released' contest.slug task.name %}"
                    class="btn btn-default"
                    title="PDF">
                    <i class="fa fa-btns fa-file-pdf-o fa-lg"></i>
                  </a>
                  {% if settings.PRINT_ENABLED and is_editor and not is_online %}
                      <button
                        onclick="sendPrint('{% url 'task_print' 'released' contest.slug task.name %}')"
                        class="btn btn-default"
                        title="Print ONE copy">
                        <i class="fa fa-btn fa-print fa-lg"></i>
                      </button>
                  {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      {% if not is_editor %}
        {% if contest.user_contest %}
          <h3 style="color:green">
            All translations for {{ contest.title }} have been finalized for team {{ user.username }}. If this is an error, please contact a member of the HTC/ITC.
          </h3>
          <br>
          {% if contest.user_contest.note %}
            <b>Note:</b>
            {{contest.user_contest.note}}
          {% endif %}
          <button
            type="button"
            class="btn btn-default"
            disabled
            style="margin:0 auto;display:block;">
            Unfreeze Contest (staff)
          </button>
        {% else %}
          <form
            class="form-inline"
            method="post"
            action="{% url 'freeze_user_contest' username=user.username contest_id=contest.id%}">
            {% csrf_token %}

            {% if not is_online %}
              Select any other <b>EXTRA</b> country translations you want for your contestants and click Submit.<br><br>

              Additional copy #1:
              <select name="extra_country1">
                <option value="NONE">None</option>
                {% for user in translating_users %}
                  <option value="{{ user.country.code }}">{{ user.language.name }} ({{ user.language.code }}_{{ user.country.code2 }})</option>
                {% endfor %}
              </select>
              with
              <select name="extra_country1_count">
                <option value="0">0</option>
                {% for copy in ''|center:user.num_of_contestants %}
                  <option value="{{ forloop.counter }}">{{ forloop.counter }}</option>
                {% endfor %}
              </select>
              copies.
      				<br>
      				Additional copy #2:
              <select name="extra_country2">
                <option value="NONE">None</option>
                {% for user in translating_users %}
                  <option value="{{ user.country.code }}">{{ user.language.name }} ({{ user.language.code }}_{{ user.country.code2 }})</option>
                {% endfor %}
      				</select>
              with
              <select name="extra_country2_count">
                <option value="0">0</option>
                {% for copy in ''|center:user.num_of_contestants %}
                  <option value="{{ forloop.counter }}">{{ forloop.counter }}</option>
                {% endfor %}
              </select>
              copies.
            {% endif %}

            <!--label for="note">Freeze Note:</label-->
            <!--input type="text" class="form-control" id="note" name="note"-->
            <button
              type="submit"
              id="final_submit"
              class="btn btn-success"
              style="margin:0 auto;display:block;"
              onclick="return validateFinalizeTranslation('{{ contest.slug }}', {{ contest.tasks|length }});" >
              Submit Finalized Translations
            </button>
          </form>
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>
</div>

{% endblock %}
